#!

import argparse
from EM_shower_simulator import PACKAGE_NAME, __version__, DESCRIPTION, URL
from EM_shower_simulator.config import default_features
from EM_shower_simulator import simulate_shower as simulate



if __name__ == "__main__":
    PARSER = argparse.ArgumentParser(
       prog='simulate_EM_shower',
       formatter_class=argparse.RawTextHelpFormatter,
       description=PACKAGE_NAME + '\n' + DESCRIPTION,
       epilog=f'Further information: {URL}')
    PARSER.add_argument('-v', '--version', action='version', version=__version__)
    PARSER.add_argument('-d', '--verbose', action='store_true', help='DEBUG')
    PARSER.add_argument('-f', '--features', metavar='feature', action='store',
       nargs='+', default=default_features,
       help="allow the user to insert the shower's features from command line"
           +"\nthe argument must be a list containing the features in the "
           +"following order:\nenergy momentum angle")
    ARGS = PARSER.parse_args()

    #Arguments conversion to float
    inputs = []
    for item in ARGS.features:
        try:
           inputs.append(float(item))
        except:
           print(f'Unexpected value {item}.')

    #Start simulation
    STATE = simulate(inputs, verbose=ARGS.verbose)
    if STATE == 1:
        print('Error while loading the model.')
    else:
        print('The work is done.')
